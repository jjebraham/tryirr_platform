{% extends 'core/base.html' %}

{% block title %}Verification Center{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <h1 class="text-3xl font-bold mb-6">Verification Center</h1>

  <div class="mb-4 border-b">
    <nav class="flex -mb-px">
      <a href="#phone" class="mr-4 pb-2 border-b-2 border-blue-600">Phone Verification</a>
      <a href="#email" class="pb-2">Email Verification</a>
    </nav>
  </div>

  <div id="phone" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-6">
    <h2 class="text-xl font-semibold mb-4">Phone Verification</h2>
    <form id="phone-form">
      {% csrf_token %}
      <label class="block mb-1">Phone number</label>
      <input type="text" name="phone" class="border rounded p-2 w-full mb-3">
      <button type="button" onclick="sendCode('phone')" class="px-4 py-2 bg-blue-600 text-white rounded">Send Code</button>
    </form>
  </div>

  <div id="email" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
    <h2 class="text-xl font-semibold mb-4">Email Verification</h2>
    <form id="email-form">
      {% csrf_token %}
      <label class="block mb-1">Email</label>
      <input type="email" name="email" class="border rounded p-2 w-full mb-3">
      <button type="button" onclick="sendCode('email')" class="px-4 py-2 bg-blue-600 text-white rounded">Send Code</button>
    </form>
  </div>
</div>
<script>
  function sendCode(kind) {
    const form = document.getElementById(`${kind}-form`);
    const csrf = form.querySelector('[name=csrfmiddlewaretoken]').value;
    const value = form.querySelector('input').value;
    fetch("{% url 'core:send_code' %}", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': csrf
      },
      body: new URLSearchParams({kind: kind, target: value})
    })
    .then(r => r.json())
    .then(d => {
      alert(d.success ? 'Code sent!' : 'Error: ' + (d.error || 'unknown'));
    });
  }
</script>
{% endblock %}
